openapi: "3.0.3"
info:
  title: E-commerce API
  version: "1.0.0"
  description: |
    Backend API for basic e-commerce operations.
    Features: Product catalog, Customer registration, Shopping carts, Orders, Purchase history.

servers:
  - url: http://localhost:8000/api/v1
    description: Local development

paths:
  # =====================
  # PRODUCTS (F1-F5)
  # =====================
  /products:
    post:
      summary: F1 - Create Product
      operationId: createProduct
      tags: [Products]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProductCreate'
      responses:
        '201':
          description: Product created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Product'
        '400':
          description: Validation error

    get:
      summary: F2 - List Active Products
      operationId: listProducts
      tags: [Products]
      parameters:
        - name: skip
          in: query
          schema:
            type: integer
            default: 0
        - name: limit
          in: query
          schema:
            type: integer
            default: 100
      responses:
        '200':
          description: List of products
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Product'

  /products/{product_id}:
    get:
      summary: F3 - Get Product Details
      operationId: getProduct
      tags: [Products]
      parameters:
        - $ref: '#/components/parameters/ProductId'
      responses:
        '200':
          description: Product details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Product'
        '404':
          description: Product not found

    put:
      summary: F4 - Update Product
      operationId: updateProduct
      tags: [Products]
      parameters:
        - $ref: '#/components/parameters/ProductId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProductUpdate'
      responses:
        '200':
          description: Product updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Product'
        '404':
          description: Product not found

  /products/{product_id}/deactivate:
    post:
      summary: F5 - Deactivate Product
      operationId: deactivateProduct
      tags: [Products]
      parameters:
        - $ref: '#/components/parameters/ProductId'
      responses:
        '200':
          description: Product deactivated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Product'
        '404':
          description: Product not found

  # =====================
  # CUSTOMERS (F6-F7)
  # =====================
  /customers:
    post:
      summary: F6 - Register Customer
      operationId: registerCustomer
      tags: [Customers]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CustomerCreate'
      responses:
        '201':
          description: Customer registered
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Customer'
        '400':
          description: Email already exists

  /customers/{customer_id}:
    get:
      summary: F7 - Get Customer Details
      operationId: getCustomer
      tags: [Customers]
      parameters:
        - $ref: '#/components/parameters/CustomerId'
      responses:
        '200':
          description: Customer details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Customer'
        '404':
          description: Customer not found

  # =====================
  # CARTS (F8-F12)
  # =====================
  /carts:
    post:
      summary: F8 - Create Cart
      operationId: createCart
      tags: [Carts]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CartCreate'
      responses:
        '201':
          description: Cart created or existing returned
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Cart'

  /carts/{cart_id}:
    get:
      summary: F10 - Get Cart
      operationId: getCart
      tags: [Carts]
      parameters:
        - $ref: '#/components/parameters/CartId'
      responses:
        '200':
          description: Cart details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Cart'
        '404':
          description: Cart not found

    delete:
      summary: F12 - Clear Cart
      operationId: clearCart
      tags: [Carts]
      parameters:
        - $ref: '#/components/parameters/CartId'
      responses:
        '200':
          description: Cart cleared
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Cart'
        '404':
          description: Cart not found

  /carts/{cart_id}/items:
    post:
      summary: F9 - Add Item to Cart
      operationId: addCartItem
      tags: [Carts]
      parameters:
        - $ref: '#/components/parameters/CartId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CartItemCreate'
      responses:
        '201':
          description: Item added
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Cart'
        '400':
          description: Product inactive or insufficient stock
        '404':
          description: Cart or product not found

  /carts/{cart_id}/items/{item_id}:
    put:
      summary: F11 - Update Item Quantity
      operationId: updateCartItem
      tags: [Carts]
      parameters:
        - $ref: '#/components/parameters/CartId'
        - $ref: '#/components/parameters/ItemId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CartItemUpdate'
      responses:
        '200':
          description: Item updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Cart'
        '404':
          description: Cart or item not found

  # =====================
  # ORDERS (F13-F17)
  # =====================
  /orders:
    post:
      summary: F13 - Checkout (Create Order)
      operationId: checkout
      tags: [Orders]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CheckoutRequest'
      responses:
        '201':
          description: Order created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Order'
        '400':
          description: Empty cart or insufficient stock
        '404':
          description: Cart not found

    get:
      summary: F16 - List Customer Orders
      operationId: listOrders
      tags: [Orders]
      parameters:
        - name: customer_id
          in: query
          required: true
          schema:
            type: string
            format: uuid
        - name: status
          in: query
          schema:
            $ref: '#/components/schemas/OrderStatus'
      responses:
        '200':
          description: List of orders
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Order'

  /orders/{order_id}:
    get:
      summary: F17 - Get Order Details
      operationId: getOrder
      tags: [Orders]
      parameters:
        - $ref: '#/components/parameters/OrderId'
      responses:
        '200':
          description: Order details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Order'
        '404':
          description: Order not found

  /orders/{order_id}/pay:
    post:
      summary: F14 - Pay Order (Simulated)
      operationId: payOrder
      tags: [Orders]
      parameters:
        - $ref: '#/components/parameters/OrderId'
      responses:
        '200':
          description: Order paid
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Order'
        '400':
          description: Order not in PENDING_PAYMENT status
        '404':
          description: Order not found

  /orders/{order_id}/cancel:
    post:
      summary: F15 - Cancel Order
      operationId: cancelOrder
      tags: [Orders]
      parameters:
        - $ref: '#/components/parameters/OrderId'
      responses:
        '200':
          description: Order cancelled, stock returned
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Order'
        '400':
          description: Order not in PENDING_PAYMENT status
        '404':
          description: Order not found

components:
  parameters:
    ProductId:
      name: product_id
      in: path
      required: true
      schema:
        type: string
        format: uuid

    CustomerId:
      name: customer_id
      in: path
      required: true
      schema:
        type: string
        format: uuid

    CartId:
      name: cart_id
      in: path
      required: true
      schema:
        type: string
        format: uuid

    OrderId:
      name: order_id
      in: path
      required: true
      schema:
        type: string
        format: uuid

    ItemId:
      name: item_id
      in: path
      required: true
      schema:
        type: string
        format: uuid

  schemas:
    # =====================
    # PRODUCT SCHEMAS
    # =====================
    Product:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        description:
          type: string
          nullable: true
        price:
          type: number
          format: float
          minimum: 0.01
        stock:
          type: integer
          minimum: 0
        is_active:
          type: boolean
          default: true
      required: [id, name, price, stock]

    ProductCreate:
      type: object
      properties:
        name:
          type: string
        description:
          type: string
          nullable: true
        price:
          type: number
          format: float
          minimum: 0.01
        stock:
          type: integer
          minimum: 0
          default: 0
      required: [name, price]

    ProductUpdate:
      type: object
      properties:
        name:
          type: string
        description:
          type: string
          nullable: true
        price:
          type: number
          format: float
          minimum: 0.01
        stock:
          type: integer
          minimum: 0
        is_active:
          type: boolean

    # =====================
    # CUSTOMER SCHEMAS
    # =====================
    Customer:
      type: object
      properties:
        id:
          type: string
          format: uuid
        email:
          type: string
          format: email
        full_name:
          type: string
        created_at:
          type: string
          format: date-time
      required: [id, email, full_name, created_at]

    CustomerCreate:
      type: object
      properties:
        email:
          type: string
          format: email
        full_name:
          type: string
      required: [email, full_name]

    # =====================
    # CART SCHEMAS
    # =====================
    CartStatus:
      type: string
      enum: [OPEN, CHECKED_OUT]

    Cart:
      type: object
      properties:
        id:
          type: string
          format: uuid
        customer_id:
          type: string
          format: uuid
        status:
          $ref: '#/components/schemas/CartStatus'
        items:
          type: array
          items:
            $ref: '#/components/schemas/CartItem'
        total:
          type: number
          format: float
      required: [id, customer_id, status, items]

    CartCreate:
      type: object
      properties:
        customer_id:
          type: string
          format: uuid
      required: [customer_id]

    CartItem:
      type: object
      properties:
        id:
          type: string
          format: uuid
        product_id:
          type: string
          format: uuid
        quantity:
          type: integer
          minimum: 1
        unit_price:
          type: number
          format: float
      required: [id, product_id, quantity, unit_price]

    CartItemCreate:
      type: object
      properties:
        product_id:
          type: string
          format: uuid
        quantity:
          type: integer
          minimum: 1
          default: 1
      required: [product_id]

    CartItemUpdate:
      type: object
      properties:
        quantity:
          type: integer
          minimum: 0
      required: [quantity]

    # =====================
    # ORDER SCHEMAS
    # =====================
    OrderStatus:
      type: string
      enum: [PENDING_PAYMENT, PAID, CANCELLED]

    PaymentStatus:
      type: string
      enum: [PENDING, SIMULATED_OK, FAILED]

    Order:
      type: object
      properties:
        id:
          type: string
          format: uuid
        customer_id:
          type: string
          format: uuid
        status:
          $ref: '#/components/schemas/OrderStatus'
        payment_status:
          $ref: '#/components/schemas/PaymentStatus'
        total_amount:
          type: number
          format: float
        items:
          type: array
          items:
            $ref: '#/components/schemas/OrderItem'
        created_at:
          type: string
          format: date-time
      required: [id, customer_id, status, payment_status, total_amount, items, created_at]

    OrderItem:
      type: object
      properties:
        id:
          type: string
          format: uuid
        product_id:
          type: string
          format: uuid
        quantity:
          type: integer
          minimum: 1
        unit_price:
          type: number
          format: float
      required: [id, product_id, quantity, unit_price]

    CheckoutRequest:
      type: object
      properties:
        cart_id:
          type: string
          format: uuid
      required: [cart_id]
