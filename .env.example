# Devmatrix Environment Configuration
# Copy this file to .env and fill with your actual values
# NEVER commit .env to git!

# ========================================
# CRITICAL SECURITY SETTINGS (Phase 1)
# ========================================

# JWT Secret Key (REQUIRED - NO DEFAULT)
# This key is used to sign JWT tokens for authentication
# MUST be at least 32 characters for security
# Generate with: python -c "import secrets; print(secrets.token_hex(32))"
# CRITICAL: Change this in production! Application will fail to start if missing.
JWT_SECRET=change_this_to_at_least_32_characters_long_secret_key_REQUIRED

# Database Connection (REQUIRED - NO DEFAULT)
# PostgreSQL connection string
# Format: postgresql://username:password@host:port/database
# CRITICAL: Set valid credentials! Application will fail to start if missing.
DATABASE_URL=postgresql://devmatrix:change_this_password@localhost:5432/devmatrix

# CORS Allowed Origins (REQUIRED for web UI)
# Comma-separated list of allowed origins for CORS
# NO WILDCARDS - Exact string matching only
# Development: Include your local frontend URLs
# Production: Only include your production domain(s)
# Examples:
#   Development: http://localhost:5173,http://localhost:3000
#   Production: https://app.devmatrix.com
CORS_ALLOWED_ORIGINS=http://localhost:5173,http://localhost:3000

# ========================================
# Optional Security Settings (With Defaults)
# ========================================

# JWT Token Expiration
# Access tokens are short-lived for security
JWT_ACCESS_TOKEN_EXPIRE_MINUTES=60
# Refresh tokens allow getting new access tokens
JWT_REFRESH_TOKEN_EXPIRE_DAYS=30

# Redis Configuration (for rate limiting and token blacklist)
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=

# ========================================
# LLM Provider API Keys
# ========================================

# Anthropic Claude (Required for MVP)
# Get your key from: https://console.anthropic.com/
ANTHROPIC_API_KEY=sk-ant-your_key_here

# OpenAI GPT (Optional - for future multi-model support)
# Get your key from: https://platform.openai.com/api-keys
OPENAI_API_KEY=sk-your_key_here

# Google Gemini (Optional - for future cost optimization)
# Get your key from: https://ai.google.dev/
GOOGLE_API_KEY=your_google_key_here

# ========================================
# Database Configuration (Legacy - Use DATABASE_URL instead)
# ========================================
# These are kept for backward compatibility but DATABASE_URL takes precedence
POSTGRES_HOST=localhost
POSTGRES_PORT=5432
POSTGRES_DB=devmatrix
POSTGRES_USER=devmatrix
POSTGRES_PASSWORD=change_this_in_production

# ========================================
# RAG (Retrieval-Augmented Generation)
# ========================================

# Enable/disable RAG system
RAG_ENABLED=true

# ChromaDB Vector Database
CHROMADB_HOST=localhost
CHROMADB_PORT=8000
CHROMADB_COLLECTION=devmatrix_code_examples

# Embedding Model Configuration
# Default: all-MiniLM-L6-v2 (384 dimensions, balanced performance)
# Alternatives: all-mpnet-base-v2 (768 dims, higher quality)
RAG_EMBEDDING_MODEL=all-MiniLM-L6-v2
RAG_EMBEDDING_DIM=384

# Retrieval Strategy: similarity, mmr, hybrid
# MMR (Maximal Marginal Relevance) recommended for diversity
RAG_RETRIEVAL_STRATEGY=mmr

# Retrieval Parameters
# Number of similar examples to retrieve
RAG_TOP_K=5

# Minimum similarity threshold (0.0-1.0)
# Higher = more strict matching, lower = more permissive
RAG_SIMILARITY_THRESHOLD=0.7

# MMR Lambda (0.0-1.0): balance between similarity and diversity
# 1.0 = only similarity, 0.0 = only diversity, 0.7 = balanced (recommended)
RAG_MMR_LAMBDA=0.7

# Context Configuration
# Template: simple, detailed, structured
RAG_CONTEXT_TEMPLATE=detailed

# Maximum context length to send to LLM
RAG_MAX_CONTEXT_LENGTH=8000

# Truncate long code snippets
RAG_TRUNCATE_CODE=true
RAG_MAX_CODE_LENGTH=500

# Persistent Embedding Cache
# Enable caching of query embeddings for performance
RAG_CACHE_ENABLED=true
RAG_CACHE_DIR=.cache/rag
RAG_CACHE_MAX_ENTRIES=10000
RAG_CACHE_TTL_DAYS=30

# Feedback & Learning
# Enable feedback loop for continuous learning
RAG_FEEDBACK_ENABLED=true

# Auto-index approved code to RAG
RAG_AUTO_INDEX_ON_APPROVAL=true

# ========================================
# Application Configuration
# ========================================

# Environment: development, staging, production
ENVIRONMENT=development

# ========================================
# Logging Configuration
# ========================================

# Logging level: DEBUG, INFO, WARNING, ERROR, CRITICAL
LOG_LEVEL=INFO

# Log format: json (production), text (development)
LOG_FORMAT=text

# Log file path (optional - leave empty for stdout only)
# Example: ./logs/devmatrix.log
LOG_FILE=

# Agent workspace directory (where agents write generated code)
WORKSPACE_DIR=./workspace

# ========================================
# Cost Management
# ========================================

# Monthly budget in EUR
MONTHLY_BUDGET_EUR=200

# Alert threshold (percentage of budget)
BUDGET_ALERT_THRESHOLD=75

# Auto-throttle threshold (percentage of budget)
BUDGET_THROTTLE_THRESHOLD=90

# ========================================
# LangSmith (Optional - for debugging)
# ========================================

# Get your key from: https://smith.langchain.com/
LANGCHAIN_TRACING_V2=false
LANGCHAIN_API_KEY=your_langsmith_key_here
LANGCHAIN_PROJECT=devmatrix-mvp

# ========================================
# Legacy Security (Deprecated - Use JWT_SECRET and DATABASE_URL)
# ========================================

# Secret key for session management (DEPRECATED - Use JWT_SECRET)
SECRET_KEY=change_this_to_a_random_secret_key

# JWT Configuration (DEPRECATED - Use JWT_SECRET at top)
JWT_SECRET_KEY=change_this_to_a_random_secret_key_IMPORTANT

# Allowed workspace paths (comma-separated, for sandboxing)
ALLOWED_WORKSPACE_PATHS=./workspace,/tmp/devmatrix

# ========================================
# Authentication & Email Configuration
# ========================================

# Email Verification
# Set to true to require email verification for new users
EMAIL_VERIFICATION_REQUIRED=false
EMAIL_VERIFICATION_TOKEN_EXPIRY_HOURS=24

# Email Service
# Set to true to enable actual email sending (requires SMTP configuration)
# If false, emails will be logged to console for development
EMAIL_ENABLED=false
EMAIL_FROM_ADDRESS=noreply@devmatrix.local
EMAIL_FROM_NAME=Devmatrix

# SMTP Configuration (required if EMAIL_ENABLED=true)
# For Gmail: smtp.gmail.com:587 with TLS
# For SendGrid: smtp.sendgrid.net:587 with TLS
# For Mailgun: smtp.mailgun.org:587 with TLS
SMTP_HOST=localhost
SMTP_PORT=587
SMTP_USERNAME=
SMTP_PASSWORD=
SMTP_USE_TLS=true
SMTP_USE_SSL=false

# Frontend URL (for email links)
FRONTEND_URL=http://localhost:5173

# ========================================
# PRODUCTION DEPLOYMENT NOTES
# ========================================
#
# Before deploying to production:
#
# 1. Generate strong JWT_SECRET (32+ characters):
#    python -c "import secrets; print(secrets.token_hex(32))"
#
# 2. Set DATABASE_URL to production PostgreSQL instance
#
# 3. Set CORS_ALLOWED_ORIGINS to production domain only:
#    CORS_ALLOWED_ORIGINS=https://app.devmatrix.com
#
# 4. Change all database passwords
#
# 5. Set ENVIRONMENT=production
#
# 6. Configure Redis for production (with password)
#
# 7. Set LOG_FORMAT=json for structured logging
#
# 8. Never use default/example values in production!
