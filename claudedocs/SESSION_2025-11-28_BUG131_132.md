# Session Summary: Bug #131 & #132 Fixes
**Date:** 2025-11-28
**Branch:** feature/validation-scaling-phase1

## Bugs Fixed

### Bug #131: Service passes Pydantic to Repository instead of dict
**File:** `src/services/production_code_generators.py`
**Root Cause:** Service template called `self.repo.create(data)` where `data` was a Pydantic model, but SQLAlchemy entities expect `**dict`
**Fix:** Added `.model_dump()` call in service template:
```python
# Before
db_obj = await self.repo.create(data)

# After
db_obj = await self.repo.create(data.model_dump())
```

### Bug #132: Docker image cache causes stale code
**File:** `src/validation/runtime_smoke_validator.py`
**Root Cause:** `docker compose build` uses cached layers, so code changes weren't reflected in containers
**Fix:** Added `--no-cache` flag and separate build step:
```python
# Build without cache first
cmd = ['docker', 'compose', '-f', 'docker/docker-compose.yml', 'build', '--no-cache']
subprocess.run(cmd, cwd=str(self.app_dir), timeout=180)

# Then start containers
cmd = ['docker', 'compose', '-f', 'docker/docker-compose.yml', 'up', '-d']
```

## Test Results Comparison

| Metric | Before Fixes | After Fixes | Improvement |
|--------|-------------|-------------|-------------|
| Passed | 31 | 45 | +14 |
| Failed | 54 | 41 | -13 |
| Pass Rate | 36.5% | 52.3% | +15.8% |

## Key Observations

1. **POST endpoints fixed:** `POST /products` now returns 201 (was 500)
2. **Error type changed:** Remaining errors are 404 (not found) instead of 500 (server error)
3. **Docker cleanup works:** Containers properly stopped after tests

## Remaining Issues (41 failures)

All remaining failures are 404 errors on endpoints with path parameters:
- `GET /products/{product_id}` → 404
- `PUT /products/{product_id}` → 404
- `POST /products/{product_id}/deactivate` → 404
- Similar pattern for customers, carts, orders

**Hypothesis:** Smoke test generates invalid UUIDs or doesn't create resources before accessing them.

## Files Modified This Session

1. `src/validation/runtime_smoke_validator.py` - Bug #132 fix
2. `DOCS/mvp/exit/debug/CODE_GENERATION_BUG_FIXES.md` - Documentation

## Next Steps

1. Investigate 404 errors in smoke tests (potential Bug #133)
2. Check if smoke test properly seeds data before testing GET/PUT/DELETE
3. Verify path parameter routing in generated routes

## Generated App Location
`tests/e2e/generated_apps/ecommerce-api-spec-human_1764361688/`
