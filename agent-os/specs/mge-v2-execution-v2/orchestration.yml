# MGE V2 Execution V2 - Orchestration Configuration

name: mge-v2-execution-v2
version: 1.0.0
strategy: adaptive
priority: critical

# Execution Configuration
execution:
  mode: sequential_phases_parallel_tasks
  max_parallel_tasks: 3
  checkpoint_frequency: 15min  # User requested strict 15min progress updates
  auto_validate: true
  stop_on_critical_error: true

# Phase Configuration
phases:
  - id: phase_1
    name: "RetryOrchestrator Core"
    duration_estimate: "1 day"
    tasks: [1.1, 1.2, 1.3, 1.4]
    dependencies: []
    validation_gate:
      - "All 20+ RetryOrchestrator tests passing"
      - "Retry logic with temperature backoff working"
      - "Metrics emitting correctly"

  - id: phase_2
    name: "WaveExecutor Core"
    duration_estimate: "1 day"
    tasks: [2.1, 2.2, 2.3, 2.4, 2.5]
    dependencies: [phase_1]
    validation_gate:
      - "All 25+ WaveExecutor tests passing"
      - "Wave-based parallel execution working"
      - "Concurrency limits respected (max 100)"

  - id: phase_3
    name: "ExecutionServiceV2"
    duration_estimate: "1 day"
    tasks: [3.1, 3.2, 3.3, 3.4, 3.5]
    dependencies: [phase_2]
    validation_gate:
      - "All 15+ ExecutionServiceV2 tests passing"
      - "State management working"
      - "Cost and time tracking accurate"

  - id: phase_4
    name: "REST API Endpoints"
    duration_estimate: "1 day"
    tasks: [4.1, 4.2, 4.3, 4.4, 4.5]
    dependencies: [phase_3]
    validation_gate:
      - "All 10+ API tests passing"
      - "All 8 endpoints functional"
      - "Error handling proper"

  - id: phase_5
    name: "Integration, Metrics & Documentation"
    duration_estimate: "1 day"
    tasks: [5.1, 5.2, 5.3, 5.4, 5.5, 5.6]
    dependencies: [phase_4]
    validation_gate:
      - "Full pipeline test passing"
      - "Precision ≥95% achieved"
      - "Performance targets met"
      - "Documentation complete"

# Quality Gates
quality_gates:
  unit_tests:
    required: true
    min_coverage: 95
    fail_on_error: true

  integration_tests:
    required: true
    run_after_phase: 5
    fail_on_error: true

  performance_tests:
    required: true
    targets:
      - metric: "precision"
        min_value: 95
        unit: "percent"
      - metric: "execution_time_800_atoms"
        max_value: 5400
        unit: "seconds"  # 1.5 hours
      - metric: "cost_per_masterplan"
        max_value: 200
        unit: "usd"

  code_quality:
    lint: true
    type_check: true
    fail_on_warnings: false

# Progress Tracking
progress:
  update_frequency: 15min  # User requirement
  use_todo_write: true
  checkpoint_on:
    - task_completion
    - phase_completion
    - validation_gate
    - 15min_intervals

  metrics_to_track:
    - tasks_completed
    - tests_passing
    - code_lines_written
    - current_phase
    - time_elapsed
    - estimated_completion

# Integration Points
integrations:
  existing_components:
    - name: "EnhancedAnthropicClient"
      location: "src/llm/enhanced_anthropic_client.py"
      usage: "LLM code generation with V2 caching"

    - name: "AtomicValidator"
      location: "src/mge/v2/validation/"
      usage: "Validation framework for generated code"

    - name: "Gap 8 - Concurrency Controller"
      status: "implemented"
      usage: "Concurrency limits integration"

    - name: "Gap 9 - Cost Guardrails"
      status: "implemented"
      usage: "Cost tracking and limits"

    - name: "Gap 10 - Caching & Reuso"
      status: "implemented"
      usage: "LLM response caching"

  prometheus:
    enabled: true
    metrics_count: 15
    endpoint: "/metrics"

  fastapi:
    enabled: true
    router_prefix: "/api/v2/execution"
    endpoints_count: 8

# Testing Strategy
testing:
  unit_tests:
    framework: "pytest"
    async_support: true
    mocking: "unittest.mock"
    total_tests_target: 70

  integration_tests:
    include_e2e: true
    test_800_atom_scenario: true
    validate_integrations: true

  performance_tests:
    throughput_test: true
    concurrency_test: true
    cost_test: true

# Error Handling
error_handling:
  retry_on_transient_errors: true
  max_retries: 3
  stop_on_validation_failure: true
  cleanup_on_error: true

# Documentation
documentation:
  user_guide:
    path: "DOCS/MGE_V2/execution_v2_guide.md"
    target_lines: 600
    include_examples: true

  implementation_summary:
    path: "DOCS/MGE_V2/execution-v2-implementation-summary.md"
    target_lines: 200
    include_stats: true

# Success Criteria
success_criteria:
  must_have:
    - "WaveExecutor implemented with parallel execution"
    - "RetryOrchestrator with 4-attempt retry and temperature backoff"
    - "ExecutionServiceV2 with state management"
    - "8 REST API endpoints functional"
    - "15+ Prometheus metrics emitting"
    - "Precision ≥95%"
    - "All 70+ tests passing"
    - "Documentation complete"

  nice_to_have:
    - "Performance optimizations beyond targets"
    - "Additional error recovery strategies"
    - "Enhanced monitoring dashboards"

# Resource Estimates
resources:
  total_duration: "5 days"
  total_tasks: 28
  total_code_lines: 3400
  total_test_lines: 1200
  total_doc_lines: 800

# Validation Approach
validation:
  method: "Direct Prometheus metrics (NO canary)"
  rationale: "Simplified from original plan - direct validation via metrics"
  metrics_based: true
  canary_testing: false
  v1_comparison: false
