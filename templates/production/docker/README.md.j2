# {{ app_name | default('FastAPI Application') }}

{{ description | default('Production-ready FastAPI application with async PostgreSQL, Alembic migrations, and comprehensive monitoring.') }}

## Features

{% if entities %}
### Data Models
{% for entity in entities %}
- **{{ entity.name }}**: Manages {{ entity.plural | lower }} with full CRUD operations
{% endfor %}
{% endif %}

{% if endpoints %}
### API Endpoints
{% for endpoint in endpoints[:10] %}
- `{{ endpoint.method }} {{ endpoint.path }}`: {{ endpoint.description | default('API endpoint') }}
{% endfor %}
{% if endpoints | length > 10 %}
...and {{ endpoints | length - 10 }} more endpoints
{% endif %}
{% endif %}

## Tech Stack

- **Framework**: FastAPI (async/await)
- **Database**: PostgreSQL with SQLAlchemy 2.0 (async)
- **Validation**: Pydantic v2
- **Migrations**: Alembic
- **Logging**: structlog (structured JSON logging)
- **Monitoring**: Prometheus metrics
- **Testing**: pytest with async support
- **Containerization**: Docker & Docker Compose
- **API Documentation**: OpenAPI (Swagger) & ReDoc

## Prerequisites

- Python {{ python_version | default('3.11') }}+
- PostgreSQL 14+
- Docker & Docker Compose (optional)

## Installation

### Local Development

1. Clone the repository:
```bash
git clone <repository-url>
cd {{ app_name | default('app') | lower | replace(' ', '-') }}
```

2. Install dependencies:
```bash
pip install -r requirements.txt
# or with Poetry
poetry install
```

3. Set up environment variables:
```bash
cp .env.example .env
# Edit .env with your configuration
```

4. Run database migrations:
```bash
alembic upgrade head
```

5. Start the application:
```bash
uvicorn src.main:app --reload --host 0.0.0.0 --port 8000
```

### Docker Deployment

1. Build and start services:
```bash
docker-compose up -d
```

2. Access the application:
- API: http://localhost:8002
- API Documentation: http://localhost:8002/docs
- ReDoc: http://localhost:8002/redoc
- Prometheus: http://localhost:9091
- Grafana: http://localhost:3002 (admin/admin)

## Configuration

Create a `.env` file with the following variables:

```env
# Database
DATABASE_URL=postgresql+asyncpg://user:password@localhost:5432/dbname

# Application
APP_NAME={{ app_name | default('API') }}
ENVIRONMENT=development
DEBUG=false
LOG_LEVEL=INFO

# Security
SECRET_KEY=your-secret-key-change-in-production
CORS_ORIGINS=["http://localhost:3000"]

# Rate Limiting
RATE_LIMIT_ENABLED=true
RATE_LIMIT_PER_MINUTE=60
```

## API Documentation

Interactive API documentation is available at:
- **Swagger UI**: http://localhost:8000/docs
- **ReDoc**: http://localhost:8000/redoc

## Database Management

### Run migrations:
```bash
alembic upgrade head
```

### Create a new migration:
```bash
alembic revision --autogenerate -m "Description of changes"
```

### Rollback migration:
```bash
alembic downgrade -1
```

## Testing

### Run all tests:
```bash
pytest
```

### Run with coverage:
```bash
pytest --cov=src --cov-report=html
```

### Run specific test file:
```bash
pytest tests/integration/test_api.py
```

## Project Structure

```
.
├── src/
│   ├── api/
│   │   ├── routes/        # API endpoints
│   │   ├── health.py      # Health checks
│   │   └── metrics.py     # Prometheus metrics
│   ├── core/
│   │   ├── config.py      # Settings management
│   │   ├── database.py    # Database connection
│   │   ├── logging.py     # Logging configuration
│   │   ├── middleware.py  # Custom middleware
│   │   ├── exception_handlers.py
│   │   └── security.py    # Security utilities
│   ├── models/
│   │   ├── entities.py    # SQLAlchemy models
│   │   └── schemas.py     # Pydantic schemas
│   ├── repositories/      # Data access layer
│   ├── services/          # Business logic
│   └── main.py           # Application entry point
├── tests/
│   ├── unit/             # Unit tests
│   ├── integration/      # Integration tests
│   └── conftest.py       # Test fixtures
├── alembic/              # Database migrations
├── docker/               # Docker configuration
├── .env.example          # Environment template
├── requirements.txt      # Python dependencies
├── pyproject.toml       # Project metadata
└── Makefile             # Development commands
```

## Development

### Code Style

The project uses:
- **black** for code formatting
- **isort** for import sorting
- **flake8** for linting
- **mypy** for type checking

Format code:
```bash
make format
```

Run linters:
```bash
make lint
```

### Available Make Commands

```bash
make help        # Show all available commands
make install     # Install dependencies
make dev        # Run development server
make test       # Run tests
make format     # Format code
make lint       # Run linters
make migrate    # Run migrations
make clean      # Remove build artifacts
```

## Monitoring

### Metrics
Prometheus metrics are exposed at `/metrics/metrics` endpoint.

### Health Checks
- Liveness: `/health/health`
- Readiness: `/health/ready`

### Grafana Dashboards
Access Grafana at http://localhost:3002 (default: admin/admin) to view:
- Request rates and latencies
- Error rates
- Database connection pool metrics
- Custom business metrics

## Contributing

1. Fork the repository
2. Create a feature branch (`git checkout -b feature/amazing-feature`)
3. Commit your changes (`git commit -m 'Add amazing feature'`)
4. Push to the branch (`git push origin feature/amazing-feature`)
5. Open a Pull Request

## License

This project is licensed under the MIT License - see the LICENSE file for details.

## Support

For issues and questions, please create an issue in the GitHub repository.